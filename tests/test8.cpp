#include <gtest/gtest.h>  // googletest header file
#include <filesystem>
#include "../include/P452.hpp"
using std::filesystem::current_path;
inline std::string
resolvePath(const std::string& relPath)
{
  auto baseDir = std::filesystem::current_path();
  while (baseDir.has_relative_path()) {
    auto test = std::filesystem::path(relPath);
   auto combinePath = baseDir / test;
    if (std::filesystem::exists(combinePath)) {
      return combinePath.string();
    }
    baseDir = baseDir.parent_path();
  }
  throw std::runtime_error("File not found!" + relPath);
}
TEST(P452, Test8) {
std::string path = resolvePath("src/maps/");
P452DigitalMaps maps = P452DigitalMaps(path); // load P452 maps;
// Path profile: test_profile_flat_land_100km
double press = 1013.000000;
double temp = 15.000000;
double phit_e = 0.000000;
double phit_n = 51.800000;
double phir_e = 0.000000;
double phir_n = 50.900700;
double Gt = 20.000000;
double Gr = 5.000000;
int    pol = 2;
double dct = 500.000000;
double dcr = 500.000000;
double f = 2.000000;
double p = 50.000000;
double htg = 10.000000;
double hrg = 10.000000;
double rDist[101];
double rHeight[101];
double g[101];
int iZone[101];
rDist[0] = 0.000000000;
rDist[1] = 1.000000000;
rDist[2] = 2.000000000;
rDist[3] = 3.000000000;
rDist[4] = 4.000000000;
rDist[5] = 5.000000000;
rDist[6] = 6.000000000;
rDist[7] = 7.000000000;
rDist[8] = 8.000000000;
rDist[9] = 9.000000000;
rDist[10] = 10.000000000;
rDist[11] = 11.000000000;
rDist[12] = 12.000000000;
rDist[13] = 13.000000000;
rDist[14] = 14.000000000;
rDist[15] = 15.000000000;
rDist[16] = 16.000000000;
rDist[17] = 17.000000000;
rDist[18] = 18.000000000;
rDist[19] = 19.000000000;
rDist[20] = 20.000000000;
rDist[21] = 21.000000000;
rDist[22] = 22.000000000;
rDist[23] = 23.000000000;
rDist[24] = 24.000000000;
rDist[25] = 25.000000000;
rDist[26] = 26.000000000;
rDist[27] = 27.000000000;
rDist[28] = 28.000000000;
rDist[29] = 29.000000000;
rDist[30] = 30.000000000;
rDist[31] = 31.000000000;
rDist[32] = 32.000000000;
rDist[33] = 33.000000000;
rDist[34] = 34.000000000;
rDist[35] = 35.000000000;
rDist[36] = 36.000000000;
rDist[37] = 37.000000000;
rDist[38] = 38.000000000;
rDist[39] = 39.000000000;
rDist[40] = 40.000000000;
rDist[41] = 41.000000000;
rDist[42] = 42.000000000;
rDist[43] = 43.000000000;
rDist[44] = 44.000000000;
rDist[45] = 45.000000000;
rDist[46] = 46.000000000;
rDist[47] = 47.000000000;
rDist[48] = 48.000000000;
rDist[49] = 49.000000000;
rDist[50] = 50.000000000;
rDist[51] = 51.000000000;
rDist[52] = 52.000000000;
rDist[53] = 53.000000000;
rDist[54] = 54.000000000;
rDist[55] = 55.000000000;
rDist[56] = 56.000000000;
rDist[57] = 57.000000000;
rDist[58] = 58.000000000;
rDist[59] = 59.000000000;
rDist[60] = 60.000000000;
rDist[61] = 61.000000000;
rDist[62] = 62.000000000;
rDist[63] = 63.000000000;
rDist[64] = 64.000000000;
rDist[65] = 65.000000000;
rDist[66] = 66.000000000;
rDist[67] = 67.000000000;
rDist[68] = 68.000000000;
rDist[69] = 69.000000000;
rDist[70] = 70.000000000;
rDist[71] = 71.000000000;
rDist[72] = 72.000000000;
rDist[73] = 73.000000000;
rDist[74] = 74.000000000;
rDist[75] = 75.000000000;
rDist[76] = 76.000000000;
rDist[77] = 77.000000000;
rDist[78] = 78.000000000;
rDist[79] = 79.000000000;
rDist[80] = 80.000000000;
rDist[81] = 81.000000000;
rDist[82] = 82.000000000;
rDist[83] = 83.000000000;
rDist[84] = 84.000000000;
rDist[85] = 85.000000000;
rDist[86] = 86.000000000;
rDist[87] = 87.000000000;
rDist[88] = 88.000000000;
rDist[89] = 89.000000000;
rDist[90] = 90.000000000;
rDist[91] = 91.000000000;
rDist[92] = 92.000000000;
rDist[93] = 93.000000000;
rDist[94] = 94.000000000;
rDist[95] = 95.000000000;
rDist[96] = 96.000000000;
rDist[97] = 97.000000000;
rDist[98] = 98.000000000;
rDist[99] = 99.000000000;
rDist[100] = 100.000000000;
rHeight[0] = 0.000000;
rHeight[1] = 0.000000;
rHeight[2] = 0.000000;
rHeight[3] = 0.000000;
rHeight[4] = 0.000000;
rHeight[5] = 0.000000;
rHeight[6] = 0.000000;
rHeight[7] = 0.000000;
rHeight[8] = 0.000000;
rHeight[9] = 0.000000;
rHeight[10] = 0.000000;
rHeight[11] = 0.000000;
rHeight[12] = 0.000000;
rHeight[13] = 0.000000;
rHeight[14] = 0.000000;
rHeight[15] = 0.000000;
rHeight[16] = 0.000000;
rHeight[17] = 0.000000;
rHeight[18] = 0.000000;
rHeight[19] = 0.000000;
rHeight[20] = 0.000000;
rHeight[21] = 0.000000;
rHeight[22] = 0.000000;
rHeight[23] = 0.000000;
rHeight[24] = 0.000000;
rHeight[25] = 0.000000;
rHeight[26] = 0.000000;
rHeight[27] = 0.000000;
rHeight[28] = 0.000000;
rHeight[29] = 0.000000;
rHeight[30] = 0.000000;
rHeight[31] = 0.000000;
rHeight[32] = 0.000000;
rHeight[33] = 0.000000;
rHeight[34] = 0.000000;
rHeight[35] = 0.000000;
rHeight[36] = 0.000000;
rHeight[37] = 0.000000;
rHeight[38] = 0.000000;
rHeight[39] = 0.000000;
rHeight[40] = 0.000000;
rHeight[41] = 0.000000;
rHeight[42] = 0.000000;
rHeight[43] = 0.000000;
rHeight[44] = 0.000000;
rHeight[45] = 0.000000;
rHeight[46] = 0.000000;
rHeight[47] = 0.000000;
rHeight[48] = 0.000000;
rHeight[49] = 0.000000;
rHeight[50] = 0.000000;
rHeight[51] = 0.000000;
rHeight[52] = 0.000000;
rHeight[53] = 0.000000;
rHeight[54] = 0.000000;
rHeight[55] = 0.000000;
rHeight[56] = 0.000000;
rHeight[57] = 0.000000;
rHeight[58] = 0.000000;
rHeight[59] = 0.000000;
rHeight[60] = 0.000000;
rHeight[61] = 0.000000;
rHeight[62] = 0.000000;
rHeight[63] = 0.000000;
rHeight[64] = 0.000000;
rHeight[65] = 0.000000;
rHeight[66] = 0.000000;
rHeight[67] = 0.000000;
rHeight[68] = 0.000000;
rHeight[69] = 0.000000;
rHeight[70] = 0.000000;
rHeight[71] = 0.000000;
rHeight[72] = 0.000000;
rHeight[73] = 0.000000;
rHeight[74] = 0.000000;
rHeight[75] = 0.000000;
rHeight[76] = 0.000000;
rHeight[77] = 0.000000;
rHeight[78] = 0.000000;
rHeight[79] = 0.000000;
rHeight[80] = 0.000000;
rHeight[81] = 0.000000;
rHeight[82] = 0.000000;
rHeight[83] = 0.000000;
rHeight[84] = 0.000000;
rHeight[85] = 0.000000;
rHeight[86] = 0.000000;
rHeight[87] = 0.000000;
rHeight[88] = 0.000000;
rHeight[89] = 0.000000;
rHeight[90] = 0.000000;
rHeight[91] = 0.000000;
rHeight[92] = 0.000000;
rHeight[93] = 0.000000;
rHeight[94] = 0.000000;
rHeight[95] = 0.000000;
rHeight[96] = 0.000000;
rHeight[97] = 0.000000;
rHeight[98] = 0.000000;
rHeight[99] = 0.000000;
rHeight[100] = 0.000000;
g[0] = 0.000000;
g[1] = 0.000000;
g[2] = 0.000000;
g[3] = 0.000000;
g[4] = 0.000000;
g[5] = 0.000000;
g[6] = 0.000000;
g[7] = 0.000000;
g[8] = 0.000000;
g[9] = 0.000000;
g[10] = 0.000000;
g[11] = 0.000000;
g[12] = 0.000000;
g[13] = 0.000000;
g[14] = 0.000000;
g[15] = 0.000000;
g[16] = 0.000000;
g[17] = 0.000000;
g[18] = 0.000000;
g[19] = 0.000000;
g[20] = 0.000000;
g[21] = 0.000000;
g[22] = 0.000000;
g[23] = 0.000000;
g[24] = 0.000000;
g[25] = 0.000000;
g[26] = 0.000000;
g[27] = 0.000000;
g[28] = 0.000000;
g[29] = 0.000000;
g[30] = 0.000000;
g[31] = 0.000000;
g[32] = 0.000000;
g[33] = 0.000000;
g[34] = 0.000000;
g[35] = 0.000000;
g[36] = 0.000000;
g[37] = 0.000000;
g[38] = 0.000000;
g[39] = 0.000000;
g[40] = 0.000000;
g[41] = 0.000000;
g[42] = 0.000000;
g[43] = 0.000000;
g[44] = 0.000000;
g[45] = 0.000000;
g[46] = 0.000000;
g[47] = 0.000000;
g[48] = 0.000000;
g[49] = 0.000000;
g[50] = 0.000000;
g[51] = 0.000000;
g[52] = 0.000000;
g[53] = 0.000000;
g[54] = 0.000000;
g[55] = 0.000000;
g[56] = 0.000000;
g[57] = 0.000000;
g[58] = 0.000000;
g[59] = 0.000000;
g[60] = 0.000000;
g[61] = 0.000000;
g[62] = 0.000000;
g[63] = 0.000000;
g[64] = 0.000000;
g[65] = 0.000000;
g[66] = 0.000000;
g[67] = 0.000000;
g[68] = 0.000000;
g[69] = 0.000000;
g[70] = 0.000000;
g[71] = 0.000000;
g[72] = 0.000000;
g[73] = 0.000000;
g[74] = 0.000000;
g[75] = 0.000000;
g[76] = 0.000000;
g[77] = 0.000000;
g[78] = 0.000000;
g[79] = 0.000000;
g[80] = 0.000000;
g[81] = 0.000000;
g[82] = 0.000000;
g[83] = 0.000000;
g[84] = 0.000000;
g[85] = 0.000000;
g[86] = 0.000000;
g[87] = 0.000000;
g[88] = 0.000000;
g[89] = 0.000000;
g[90] = 0.000000;
g[91] = 0.000000;
g[92] = 0.000000;
g[93] = 0.000000;
g[94] = 0.000000;
g[95] = 0.000000;
g[96] = 0.000000;
g[97] = 0.000000;
g[98] = 0.000000;
g[99] = 0.000000;
g[100] = 0.000000;
iZone[0] = 2;
iZone[1] = 2;
iZone[2] = 2;
iZone[3] = 2;
iZone[4] = 2;
iZone[5] = 2;
iZone[6] = 2;
iZone[7] = 2;
iZone[8] = 2;
iZone[9] = 2;
iZone[10] = 2;
iZone[11] = 2;
iZone[12] = 2;
iZone[13] = 2;
iZone[14] = 2;
iZone[15] = 2;
iZone[16] = 2;
iZone[17] = 2;
iZone[18] = 2;
iZone[19] = 2;
iZone[20] = 2;
iZone[21] = 2;
iZone[22] = 2;
iZone[23] = 2;
iZone[24] = 2;
iZone[25] = 2;
iZone[26] = 2;
iZone[27] = 2;
iZone[28] = 2;
iZone[29] = 2;
iZone[30] = 2;
iZone[31] = 2;
iZone[32] = 2;
iZone[33] = 2;
iZone[34] = 2;
iZone[35] = 2;
iZone[36] = 2;
iZone[37] = 2;
iZone[38] = 2;
iZone[39] = 2;
iZone[40] = 2;
iZone[41] = 2;
iZone[42] = 2;
iZone[43] = 2;
iZone[44] = 2;
iZone[45] = 2;
iZone[46] = 2;
iZone[47] = 2;
iZone[48] = 2;
iZone[49] = 2;
iZone[50] = 2;
iZone[51] = 2;
iZone[52] = 2;
iZone[53] = 2;
iZone[54] = 2;
iZone[55] = 2;
iZone[56] = 2;
iZone[57] = 2;
iZone[58] = 2;
iZone[59] = 2;
iZone[60] = 2;
iZone[61] = 2;
iZone[62] = 2;
iZone[63] = 2;
iZone[64] = 2;
iZone[65] = 2;
iZone[66] = 2;
iZone[67] = 2;
iZone[68] = 2;
iZone[69] = 2;
iZone[70] = 2;
iZone[71] = 2;
iZone[72] = 2;
iZone[73] = 2;
iZone[74] = 2;
iZone[75] = 2;
iZone[76] = 2;
iZone[77] = 2;
iZone[78] = 2;
iZone[79] = 2;
iZone[80] = 2;
iZone[81] = 2;
iZone[82] = 2;
iZone[83] = 2;
iZone[84] = 2;
iZone[85] = 2;
iZone[86] = 2;
iZone[87] = 2;
iZone[88] = 2;
iZone[89] = 2;
iZone[90] = 2;
iZone[91] = 2;
iZone[92] = 2;
iZone[93] = 2;
iZone[94] = 2;
iZone[95] = 2;
iZone[96] = 2;
iZone[97] = 2;
iZone[98] = 2;
iZone[99] = 2;
iZone[100] = 2;
double ff[35];
double pp[35];
ff[0] = 2.0000000000000000;
ff[1] = 0.1000000000000000;
ff[2] = 0.2500000000000000;
ff[3] = 0.5000000000000000;
ff[4] = 0.7500000000000000;
ff[5] = 1.0000000000000000;
ff[6] = 2.5000000000000000;
ff[7] = 5.0000000000000000;
ff[8] = 7.5000000000000000;
ff[9] = 10.0000000000000000;
ff[10] = 15.0000000000000000;
ff[11] = 20.0000000000000000;
ff[12] = 25.0000000000000000;
ff[13] = 30.0000000000000000;
ff[14] = 35.0000000000000000;
ff[15] = 40.0000000000000000;
ff[16] = 45.0000000000000000;
ff[17] = 50.0000000000000000;
ff[18] = 2.0000000000000000;
ff[19] = 2.0000000000000000;
ff[20] = 2.0000000000000000;
ff[21] = 2.0000000000000000;
ff[22] = 2.0000000000000000;
ff[23] = 2.0000000000000000;
ff[24] = 2.0000000000000000;
ff[25] = 2.0000000000000000;
ff[26] = 2.0000000000000000;
ff[27] = 2.0000000000000000;
ff[28] = 2.0000000000000000;
ff[29] = 2.0000000000000000;
ff[30] = 2.0000000000000000;
ff[31] = 2.0000000000000000;
ff[32] = 2.0000000000000000;
ff[33] = 2.0000000000000000;
ff[34] = 2.0000000000000000;
pp[0] = 50.0000000000000000;
pp[1] = 50.0000000000000000;
pp[2] = 50.0000000000000000;
pp[3] = 50.0000000000000000;
pp[4] = 50.0000000000000000;
pp[5] = 50.0000000000000000;
pp[6] = 50.0000000000000000;
pp[7] = 50.0000000000000000;
pp[8] = 50.0000000000000000;
pp[9] = 50.0000000000000000;
pp[10] = 50.0000000000000000;
pp[11] = 50.0000000000000000;
pp[12] = 50.0000000000000000;
pp[13] = 50.0000000000000000;
pp[14] = 50.0000000000000000;
pp[15] = 50.0000000000000000;
pp[16] = 50.0000000000000000;
pp[17] = 50.0000000000000000;
pp[18] = 0.0100000000000000;
pp[19] = 0.0200000000000000;
pp[20] = 0.0500000000000000;
pp[21] = 0.1000000000000000;
pp[22] = 0.2000000000000000;
pp[23] = 0.5000000000000000;
pp[24] = 1.0000000000000000;
pp[25] = 5.0000000000000000;
pp[26] = 10.0000000000000000;
pp[27] = 15.0000000000000000;
pp[28] = 20.0000000000000000;
pp[29] = 25.0000000000000000;
pp[30] = 30.0000000000000000;
pp[31] = 35.0000000000000000;
pp[32] = 40.0000000000000000;
pp[33] = 45.0000000000000000;
pp[34] = 50.0000000000000000;
// Results obtained from the MATLAB implementation of ITU-R P.452-18
// available on the ITU-R SG3 sharefolder
double expectedResult[35];
expectedResult[0] =  194.2497462833352415;
expectedResult[1] =  156.8371422375046222;
expectedResult[2] =  169.0686766427336920;
expectedResult[3] =  177.9200795071816401;
expectedResult[4] =  182.9199311974271609;
expectedResult[5] =  186.3610297224707608;
expectedResult[6] =  196.6749258905534532;
expectedResult[7] =  203.9101133153932324;
expectedResult[8] =  207.9854993921945834;
expectedResult[9] =  210.8633188686778510;
expectedResult[10] =  215.2203347981391346;
expectedResult[11] =  221.0870415798573845;
expectedResult[12] =  224.6490591026515062;
expectedResult[13] =  224.3495788981164480;
expectedResult[14] =  226.4920257761534117;
expectedResult[15] =  229.8972348078593200;
expectedResult[16] =  236.0999962881420799;
expectedResult[17] =  255.1346800149452747;
expectedResult[18] =  132.5310498960009795;
expectedResult[19] =  133.7869102849205376;
expectedResult[20] =  135.9702331336820862;
expectedResult[21] =  138.2407584791045281;
expectedResult[22] =  141.2717959179410343;
expectedResult[23] =  146.8120463529338906;
expectedResult[24] =  152.4971111620930628;
expectedResult[25] =  173.1707434880823087;
expectedResult[26] =  185.1227268012668787;
expectedResult[27] =  187.8002548022962515;
expectedResult[28] =  188.9493342394046635;
expectedResult[29] =  189.8910439016392786;
expectedResult[30] =  190.7295875952593462;
expectedResult[31] =  191.5122007373774977;
expectedResult[32] =  192.2783249307940423;
expectedResult[33] =  193.0838902653339062;
expectedResult[34] =  194.2497462833352415;
vector<double> rDisti;
rDisti.reserve(101);
vector<double> rHeighti;
rHeighti.reserve(101);
vector<double> gHeighti;
gHeighti.reserve(101);
vector<int> iZonei;
iZonei.reserve(101);
for (int i = 0; i < 101; i++) {
       rDisti.push_back(rDist[i]);
       rHeighti.push_back(rHeight[i]);
       gHeighti.push_back(g[i]);
       iZonei.push_back(iZone[i]);
}
for (int ii = 0; ii < 35; ii++) {
double result = tl_p452(maps,ff[ii], pp[ii], rDisti, rHeighti, gHeighti, iZonei, htg, hrg, phit_e, phit_n, phir_e, phir_n,  Gt, Gr, pol, dct, dcr, press, temp);
EXPECT_NEAR(expectedResult[ii], result, 0.000001);
  }
}
